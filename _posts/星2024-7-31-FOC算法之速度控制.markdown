---
layout:     post
title:      "FOC算法之速度控制"
subtitle:   " \"FOC算法, FOC Blog\""
date:       2024-7-31 12:00:00
author:     "Xh"
header-img: "img/cw32project/CW32_BLDC_EVA.jpg"
catalog: true
tags:
    - note
    - 单片机
    - CW32
    - FOC算法
---

# 一、FOC算法控制过程

FOC算法是一种基于电磁场的控制算法，它通过测量电磁场的变化来控制电机的转速。其基本思想是通过测量电磁场的变化来确定电机的转速，然后通过改变电机的转矩来改变电机的转速。

## 1. FOC算法的控制过程如下：

1.帕克变换：将电磁场转换为电流信号，并将电流信号转换为电机的转矩。

2.克拉克变换：将电机的转矩转换为电机的转速。

3.驱动器控制：通过改变电机的转速来控制电机的转动。

```mermaid
graph TD;
    A[逆帕克变换] --> B[逆克拉克变换];
    B --> C[驱动器控制];
    C --> D[控制电机转动];
```
## 2. 三项电压矢量

### 三相电压矢量的基本原理

在三相交流电系统中，三相电压通过旋转矢量的形式表示，可以简化电机控制和分析的过程。以下是基本原理的详细解释：

#### 三相电压表达式

在三相系统中，三相电压 \(v_a(t)\)、\(v_b(t)\) 和 \(v_c(t)\) 的时间函数可以表示为：

\[ 
v_a(t) = V_m \sin(\omega t) 
\]

\[ 
v_b(t) = V_m \sin(\omega t - 120^\circ) 
\]

\[ 
v_c(t) = V_m \sin(\omega t + 120^\circ) 
\]

#### 克拉克变换 (Clark Transformation)

克拉克变换用于将三相系统（abc坐标系）转换为两相系统（αβ坐标系），以简化三相交流电的分析。变换公式如下：

\[ 
v_\alpha = v_a 
\]

\[ 
v_\beta = \frac{1}{\sqrt{3}}(v_a + 2v_b) 
\]

通过克拉克变换，原来的三相静止坐标系（abc）被转换为静止的两相坐标系（αβ）。

#### 帕克变换 (Park Transformation)

帕克变换进一步将 αβ 坐标系转换为 dq 坐标系，这个坐标系是旋转的，与电机的磁场同步旋转。这样可以将交流变量转换为直流变量，便于控制。变换公式如下：

\[ 
v_d = v_\alpha \cos(\theta) + v_\beta \sin(\theta) 
\]

\[ 
v_q = -v_\alpha \sin(\theta) + v_\beta \cos(\theta) 
\]

其中，θ 是电机的旋转角。

#### 三相电压矢量的表示

通过克拉克和帕克变换，将三相电压用矢量表示的方法如下：

1. **输入三相电压（abc）**：三个正弦波电压。
2. **克拉克变换**：将 abc 坐标系转换为 αβ 坐标系，这是一种静止的两相坐标系。
3. **帕克变换**：将 αβ 坐标系转换为 dq 坐标系，这是与电机旋转同步的坐标系。
4. **控制算法**：在 dq 坐标系下应用控制算法来控制电机的转矩和磁通。
5. **逆帕克变换**：将 dq 坐标系的控制变量转换回 αβ 坐标系。
6. **逆克拉克变换**：将 αβ 坐标系转换回 abc 坐标系。
7. **生成 PWM 信号**：根据控制变量生成 PWM 信号来驱动电机。

#### 流程图示例

以下是用 Mermaid.js 绘制的流程图示例：

```mermaid
graph TD;
    A[输入三相电压] --> B[abc坐标系];
    B --> C[Clark变换];
    C --> D[αβ坐标系];
    D --> E[PARK变换];
    E --> F[dq坐标系];
    F --> G[控制算法];
    G --> H[逆PARK变换];
    H --> I[逆Clark变换];
    I --> J[生成三相PWM信号];
```

### 3. 电角度与机械角度的关系

在电机控制中，电角度和机械角度的关系是一个重要的概念。它们之间的关系可以通过电机的极对数来描述。以下是这个关系的详细解释：

#### 定义

- **机械角度**：机械角度 \(\theta_m\) 是电机转子的实际旋转角度。
- **电角度**：电角度 \(\theta_e\) 是定子磁场在空间中的旋转角度。

#### 关系

电角度和机械角度之间的关系可以通过电机的极对数 \(P\) 表示：

\[ 
\theta_e = \frac{P}{2} \theta_m 
\]

其中，\(P\) 是电机的极对数。极对数 \(P\) 是电机的磁极对数，每个极对表示一对磁极。

#### 示例

- 对于一个两极电机（P = 2）：
  \[
  \theta_e = \theta_m 
  \]
  这意味着电角度和机械角度相等。

- 对于一个四极电机（P = 4）：
  \[
  \theta_e = 2 \theta_m 
  \]
  这意味着电角度是机械角度的两倍。
